<script>
// Função corrigida para enviar qualquer tipo de formulário
async function handleFormSubmit(event, formType) {
    event.preventDefault();
    
    const form = event.target;
    const formData = new FormData(form);
    const submitBtn = form.querySelector('button[type="submit"]');
    
    // Mostrar loading
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
    
    try {
        const data = {
            report_type: formType,
            description: formData.get('description'),
            whatsapp: formData.get('whatsapp') || null
        };

        // Dados específicos para solicitação de conteúdo
        if (formType === 'request') {
            data.content_type = formData.get('type');
            data.content_name = formData.get('content_name');
            data.reason = formData.get('reason');
        } 
        // Dados específicos para reporte de problema
        else {
            data.problem_type = formData.get('type');
        }

        const response = await fetch('/.netlify/functions/submit-report', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (!response.ok) throw new Error(result.error || 'Erro desconhecido');

        // Sucesso!
        alert(result.message);
        form.reset();
        
    } catch (error) {
        console.error('Erro:', error);
        alert(`Erro ao enviar: ${error.message}`);
    } finally {
        // Restaurar botão
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Enviar';
    }
}

// Configurar listeners para os formulários
document.addEventListener('DOMContentLoaded', () => {
    // Formulário de problema
    const problemForm = document.getElementById('problemForm');
    if (problemForm) {
        problemForm.addEventListener('submit', (e) => handleFormSubmit(e, 'problem'));
    }

    // Formulário de solicitação
    const requestForm = document.getElementById('requestForm');
    if (requestForm) {
        requestForm.addEventListener('submit', (e) => handleFormSubmit(e, 'request'));
    }
});
</script>
